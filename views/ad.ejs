<form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
<table id="ad">
	<thead>
		<tr><th></th><th>Uzupełnij dane</th></tr>
	</thead>
	<tbody>
		<tr>
			<td>Marka:</td><td><input type="text" name="brand" placeholder="Wpisz markę"></input></td>
			<td>Model:</td><td><input type="text" name="model" placeholder="Wpisz model"></input></td>
		</tr>
		<tr>
			<td>Wersja:</td><td><input type="text" name="version" placeholder="Wpisz wersję"></input></td>
			<td>Rok produkcji:</td><td><input type="text" name="year" placeholder="Wpisz rok"></input></td>
		</tr>
		<tr>
			<td>Pojemność skokowa:</td><td><input type="text" name="capacity" placeholder="Wpisz pojemność"></input></td>
			<td>Moc:</td><td><input type="text" name="power" placeholder="Wpisz moc"></input></td>
		</tr>
		<tr>
			<td>Rodzaj paliwa:</td><td><input type="text" name="fuel" placeholder="Wpisz rodzaj"></input></td>
			<td>Skrzynia biegów:</td><td><input type="text" name="gearbox" placeholder="Wpisz rodzaj"></input></td>
		</tr>
		<tr>
			<td>Napęd:</td><td><input type="text" name="drive" placeholder="Wpisz rodzaj"></input></td>
			<td>Typ:</td><td><input type="text" name="type" placeholder="Wpisz typ auta"></input></td>
		</tr>
		<tr>
			<td>Liczba drzwi:</td><td><input type="text" name="doors" placeholder="Wpisz ilość"></input></td>
			<td>Liczba miejsc:</td><td><input type="text" name="seats" placeholder="Wpisz ilość"></input></td>
		</tr>
		<tr>
			<td>Kierownica:</td><td><input type="text" name="wheel" placeholder="Wpisz stronę"></input></td>
			<td>Faktura VAT:</td><td><input type="text" name="vat" placeholder="Wpisz czy faktura"></input></td>
		</tr>
		<tr>
			<td>Punkt odbioru:</td><td><input type="text" name="place" placeholder="Wpisz adres"></input></td>
			<td></td><td></td>
		</tr>
		<tr><td></td><td></td><td></td><td><a href="/cars">UMIEŚĆ</a></td></tr>
	</tbody>
</table>
<br />
<div id="line1"><label for="file1">Zdjecie(1): </label><a href="/" name="reset1">Anuluj</a><input type="file" name="file1"><br /></div>
<div id="line2"><label for="file2">Zdjecie(2): </label><a href="/" name="reset2">Anuluj</a><input type="file" name="file2" disabled><br /></div>
<div id="line3"><label for="file3">Zdjecie(3): </label><a href="/" name="reset3">Anuluj</a><input type="file" name="file3" disabled><br /></div>
<div id="line4"><label for="file4">Zdjecie(4): </label><a href="/" name="reset4">Anuluj</a><input type="file" name="file4" disabled><br /></div>
<div id="line5"><label for="file5">Zdjecie(5): </label><a href="/" name="reset5">Anuluj</a><input type="file" name="file5" disabled><br /></div>
<div id="line6"><label for="file6">Zdjecie(6): </label><a href="/" name="reset6">Anuluj</a><input type="file" name="file6" disabled><br /></div>
</form>
<script>
	$('#line2,#line3,#line4,#line5,#line6').hide();
	
	var unlock = function(nr){
		$('input[name="file'+(nr-1)+'"]').change(function(){
			$('input[name="file'+nr+'"]').attr('disabled',false);
			$('#line'+nr).show();
			//alert($('input[name="file1"]').val().replace(/C:\\fakepath\\/i, ''));
		});
	};
	unlock(2);	unlock(3);	unlock(4);	unlock(5);	unlock(6);
	var lock = function(nr){
		$('input[name="file'+nr+'"]').attr('disabled',true);
		$('#line'+nr).hide();
		$('input[name="file'+nr+'"]').val('');		
	};

	$('a[name="reset1"').click(function(event){ 
		event.preventDefault();
		$('input[name="file1"]').val('');
		lock(2); lock(3); lock(4); lock(5); lock(6);
	});

	$('a[name="reset2"').click(function(event){ 
		event.preventDefault();
		$('input[name="file2"]').val('');
		lock(3); lock(4); lock(5); lock(6);
	});

	$('a[name="reset3"').click(function(event){ 
		event.preventDefault();
		$('input[name="file3"]').val('');
		lock(4); lock(5); lock(6);
	});

	$('a[name="reset4"').click(function(event){ 
		event.preventDefault();
		$('input[name="file4"]').val('');
		lock(5); lock(6);
	});

	$('a[name="reset5"').click(function(event){ 
		event.preventDefault();
		$('input[name="file5"]').val('');
		lock(6);
	});

	$('a[name="reset6"').click(function(event){ 
		event.preventDefault();
		$('input[name="file6"]').val('');
	});
	
	
	

	$("input[name='brand']").focus();
	$('#uploadForm').submit(function(){
		var curr_date = new Date();
		var date_string = curr_date.getFullYear() +'_'+
						(curr_date.getMonth()+1)+'_'+
						curr_date.getDate()+'_'+
						curr_date.getHours()+'_'+
						curr_date.getMinutes()+'_'+
						curr_date.getSeconds();
		// musi byc prepend! jak zrobimy append to nie bedzie dzialac
		// poniewaz type=file musi byc na koncu formularza, bo inaczej nie widzi tego co ponizej
		$('<input />').attr('type','hidden')
					.attr('name','date')
					.attr('value',date_string)
					.prependTo('#uploadForm');
		$(this).ajaxSubmit({
			error: function(xhr){
				alert("ERROR");
			},
			success: function(response){
				if(response="ok"){
					var brand = $("input[name='brand']");
					var model = $("input[name='model']");
					var version = $("input[name='version']");
					var year = $("input[name='year']");
					var capacity = $("input[name='capacity']");
					var power = $("input[name='power']");
					var fuel = $("input[name='fuel']");
					var gearbox = $("input[name='gearbox']");
					var drive = $("input[name='drive']");
					var type = $("input[name='type']");
					var doors = $("input[name='doors']");
					var seats = $("input[name='seats']");
					var wheel = $("input[name='wheel']");
					var vat = $("input[name='vat']");
					var place = $("input[name='place']");
					var date = $("input[name='date']");
					var filename1 = $("input[name='file1']").get(0).files[0];
					var filename2 = $("input[name='file2']").get(0).files[0];
					var filename3 = $("input[name='file3']").get(0).files[0];
					var filename4 = $("input[name='file4']").get(0).files[0];
					var filename5 = $("input[name='file5']").get(0).files[0];
					var filename6 = $("input[name='file6']").get(0).files[0];
					filename1 = (filename1!=undefined) ? filename1.name : "";
					filename2 = (filename2!=undefined) ? filename2.name : "";
					filename3 = (filename3!=undefined) ? filename3.name : "";
					filename4 = (filename4!=undefined) ? filename4.name : "";
					filename5 = (filename5!=undefined) ? filename5.name : "";
					filename6 = (filename6!=undefined) ? filename6.name : "";

					if(confirm('Jesteś pewien?')){
						$.post('/proposal',
							{
								brand: brand.val(),
								model: model.val(),
								version: version.val(),
								year: year.val(),
								capacity: capacity.val(),
								power: power.val(),
								fuel: fuel.val(),
								gearbox: gearbox.val(),
								drive: drive.val(),
								type: type.val(),
								doors: doors.val(),
								seats: seats.val(),
								wheel: wheel.val(),
								vat: vat.val(),
								place: place.val(),
								post_date: date.val(),
								filename1: filename1,	filename2: filename2,
								filename3: filename3,	filename4: filename4,
								filename5: filename5,	filename6: filename6
							},
							function(data){
								if(data=='added'){
									$.get('/cars',function(data){
										$('#content').html(data);
									});
								} else {
									alert("Coś poszło nie tak...");
								}
							}
						);
					}
				}
			}
		});
		// KONIECZNE, BO INACZEJ NIE WYKONUJE "success" tylko laduje res.send('ok')
		return false;
	});
	$('#ad a').click(function(event){
		event.preventDefault();
		$('#uploadForm').submit();
		
	});
</script>